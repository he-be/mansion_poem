# ãƒãƒ³ã‚·ãƒ§ãƒ³ãƒã‚¨ãƒãƒ¼

ç¾å®Ÿã¨ã„ã†åã®ç´ æã‚’ã€è¨€è‘‰ã¨ã„ã†åã®èŠ¸è¡“ã¸ã€‚

ãƒãƒ³ã‚·ãƒ§ãƒ³åºƒå‘Šé¢¨ã®ãƒã‚¨ãƒ ã‚’ç”Ÿæˆã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

## ğŸ¯ æ¦‚è¦

5ã¤ã®æ¡ä»¶ã‚«ãƒ¼ãƒ‰ã‹ã‚‰è©©çš„ãªè¨€ã„æ›ãˆã‚’é¸ã³ã€ãã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã¦ä¸€ã¤ã®æ´—ç·´ã•ã‚ŒãŸãƒãƒ³ã‚·ãƒ§ãƒ³åºƒå‘Šæ–‡ã‚’ç”Ÿæˆã—ã¾ã™ã€‚Google Gemini APIã‚’ä½¿ç”¨ã—ã¦ã€é¸æŠã•ã‚ŒãŸè¦ç´ ã‚’çµ±åˆãƒ»æ˜‡è¯ã—ãŸæœ¬æ ¼çš„ãªãƒãƒ³ã‚·ãƒ§ãƒ³ãƒã‚¨ãƒ ã‚’ä½œæˆã—ã¾ã™ã€‚

## âœ¨ æ©Ÿèƒ½

- **ã‚«ãƒ¼ãƒ‰é¸æŠã‚·ã‚¹ãƒ†ãƒ **: 5æšã®æ¡ä»¶ã‚«ãƒ¼ãƒ‰ã‹ã‚‰ã€ãã‚Œãã‚Œãƒã‚¨ãƒ ã‚’é¸æŠ
- **AIçµ±åˆ**: Gemini Flash APIã§é¸æŠã•ã‚ŒãŸãƒã‚¨ãƒ ã‚’çµ±åˆãƒ»å†æ§‹ç¯‰
- **ãƒ©ã‚°ã‚¸ãƒ¥ã‚¢ãƒªãƒ¼UI**: ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã¨æ˜æœä½“ãƒ•ã‚©ãƒ³ãƒˆã«ã‚ˆã‚‹é«˜ç´šæ„Ÿã®ã‚ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ**: PCãƒ»ãƒ¢ãƒã‚¤ãƒ«ä¸¡å¯¾å¿œ
- **èƒŒæ™¯ç”»åƒè¡¨ç¤º**: ç”Ÿæˆã•ã‚ŒãŸãƒã‚¨ãƒ ã‚’ç¾ã—ã„èƒŒæ™¯ç”»åƒã®ä¸Šã«è¡¨ç¤º

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Vue 3 + TypeScript + Vite
- **çŠ¶æ…‹ç®¡ç†**: Pinia
- **ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: Vue Router
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: Cloudflare Workers + Assets
- **AI**: Google Gemini Flash (gemini-flash-latest)

## ğŸ“¦ é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Node.js 18ä»¥ä¸Š
- npm

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
npm run dev
```

é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã¯ `http://localhost:5173` ã§èµ·å‹•ã—ã¾ã™ã€‚

### ãƒ“ãƒ«ãƒ‰

```bash
npm run build
```

ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã¯ `dist/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

## ğŸš€ Cloudflare Workersã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### å‰ææ¡ä»¶

- Cloudflareã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆç„¡æ–™ãƒ—ãƒ©ãƒ³ã§OKï¼‰
- Google Gemini APIã‚­ãƒ¼

### 1. Cloudflare Secrets Storeã«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç™»éŒ²

```bash
# Wranglerã«ãƒ­ã‚°ã‚¤ãƒ³
npx wrangler login

# Secrets Storeã‚’ä½œæˆ
npx wrangler secrets-store create mansion-poem-secrets

# ä½œæˆã•ã‚ŒãŸStore IDã‚’ãƒ¡ãƒ¢ã—ã¦ãŠã
# ä¾‹: Store ID: abc123def456...

# Gemini APIã‚­ãƒ¼ã‚’ç™»éŒ²
npx wrangler secrets-store secret put GEMINI_API_KEY --store-id=YOUR_STORE_ID
# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§APIã‚­ãƒ¼ã‚’å…¥åŠ›
```

### 2. wrangler.tomlã‚’è¨­å®š

`wrangler.toml`ã®`store_id`ã‚’è‡ªåˆ†ã®Store IDã«å¤‰æ›´ï¼š

```toml
[[secrets_store_secrets]]
binding = "GEMINI_API_KEY"
store_id = "YOUR_STORE_ID"  # â† ã“ã“ã‚’å¤‰æ›´
secret_name = "GEMINI_API_KEY"
```

### 3. Workeråã®å¤‰æ›´ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

`wrangler.toml`ã®`name`ã‚’å¤‰æ›´ã—ã¦ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®šï¼š

```toml
name = "your-worker-name"  # your-worker-name.workers.dev ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
```

### 4. ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
npm run deploy
```

ãƒ‡ãƒ—ãƒ­ã‚¤ãŒæˆåŠŸã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
âœ¨ Successfully deployed mansionpoem
ğŸŒ https://mansionpoem.your-account.workers.dev
```

## ğŸ“ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev

# å‹ãƒã‚§ãƒƒã‚¯
npm run typecheck

# ãƒ“ãƒ«ãƒ‰
npm run build

# ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆãƒ“ãƒ«ãƒ‰å¾Œã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰
npm run preview

# ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆãƒ“ãƒ«ãƒ‰ + Cloudflare Workersã¸ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰
npm run deploy

# ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å¤‰æ›
npm run generate-cards
```

## ğŸ”§ KV/D1ç®¡ç†ã‚³ãƒãƒ³ãƒ‰

### KVã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ›´æ–°

```bash
# prompt.txtã‚’KVã«åæ˜ 
npx wrangler kv key put "prompt:poem_generation" --path="src/data/prompt.txt" --namespace-id 52e86897f88e44bda74c9bde3e3a1807
```

### KVã¸ã®ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æ›´æ–°

```bash
# cards.jsonã‚’KVã«åæ˜ 
npx wrangler kv key put "cards:all" --path="src/data/cards.json" --namespace-id 52e86897f88e44bda74c9bde3e3a1807
```

### D1ãƒ­ã‚°ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

```bash
# generation_logsãƒ†ãƒ¼ãƒ–ãƒ«ã‚’JSONå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
npx wrangler d1 execute mansion-poem-db --remote --command "SELECT * FROM generation_logs" --json > generation_logs.json

# CSVã¨ã—ã¦æ‰±ã„ãŸã„å ´åˆã¯ã€jqã§å¤‰æ›
cat generation_logs.json | jq -r '.[0].results[] | [.id, .timestamp, .title, .poem_text, .selected_cards] | @csv' > generation_logs.csv
```

### D1ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¢ºèª

```bash
# ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§
npx wrangler d1 execute mansion-poem-db --remote --command "SELECT name FROM sqlite_master WHERE type='table'"

# ãƒ­ã‚°ä»¶æ•°ã®ç¢ºèª
npx wrangler d1 execute mansion-poem-db --remote --command "SELECT COUNT(*) as count FROM generation_logs"

# æœ€æ–°10ä»¶ã®ç¢ºèª
npx wrangler d1 execute mansion-poem-db --remote --command "SELECT * FROM generation_logs ORDER BY timestamp DESC LIMIT 10"
```

## ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
mansion_poem/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/          # é™çš„ã‚¢ã‚»ãƒƒãƒˆ
â”‚   â”œâ”€â”€ components/      # Vueã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ cards/       # ã‚«ãƒ¼ãƒ‰é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ common/      # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ modals/      # ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ data/            # ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ stores/          # Piniaã‚¹ãƒˆã‚¢
â”‚   â”œâ”€â”€ types/           # TypeScriptå‹å®šç¾©
â”‚   â”œâ”€â”€ utils/           # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â”œâ”€â”€ views/           # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ worker.ts        # Cloudflare Workerã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ App.vue          # ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ main.ts          # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ public/              # å…¬é–‹é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ docs/                # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ wrangler.toml        # Cloudflare Workersè¨­å®š
â””â”€â”€ package.json
```

## ğŸ¨ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### èƒŒæ™¯ç”»åƒã®å¤‰æ›´

`public/img/bg_1.png` ã‚’ç½®ãæ›ãˆã‚‹ã“ã¨ã§ã€çµæœç”»é¢ã®èƒŒæ™¯ç”»åƒã‚’å¤‰æ›´ã§ãã¾ã™ã€‚

### ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®ç·¨é›†

ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã¯ `src/data/cards.json` ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚
ç·¨é›†å¾Œã€æœ¬ç•ªç’°å¢ƒã«åæ˜ ã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```bash
npx wrangler kv key put "cards:all" --path="src/data/cards.json" --namespace-id 52e86897f88e44bda74c9bde3e3a1807
```

### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®èª¿æ•´

Gemini APIã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ `src/data/prompt.txt` ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚
ç·¨é›†å¾Œã€æœ¬ç•ªç’°å¢ƒã«åæ˜ ã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```bash
npx wrangler kv key put "prompt:poem_generation" --path="src/data/prompt.txt" --namespace-id 52e86897f88e44bda74c9bde3e3a1807
```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **APIã‚­ãƒ¼ç®¡ç†**: Gemini APIã‚­ãƒ¼ã¯Cloudflare Secrets Storeã§å®‰å…¨ã«ç®¡ç†
- **ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å‡¦ç†**: APIã‚­ãƒ¼ã¯Workerå´ã§ä½¿ç”¨ã•ã‚Œã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å…¬é–‹ã•ã‚Œã¾ã›ã‚“
- **ç’°å¢ƒåˆ†é›¢**: é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã§ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’åˆ†é›¢å¯èƒ½

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

## ğŸ™ è¬è¾

- **Google Gemini API**: ãƒã‚¨ãƒ ç”Ÿæˆã®AIã‚¨ãƒ³ã‚¸ãƒ³
- **Cloudflare Workers**: ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ
- **Vue.js**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
