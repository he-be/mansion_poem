ファインチューニングにより専用のモデルを作成したため、以下の記述を参考にオフラインモードはすべてこのモデルで動作させる。
プロンプトは動的な部分を除き完全に同一の内容を保ってリクエストする。専用モデルのためプロンプトの揺らぎは精度に影響が大きい。
動的な部分もフォーマットが崩れないように差し替えること。


request.json
{
  "messages": [
    {
      "role": "system",
      "content": "あなたは一流不動産広告のクリエイティブディレクターです。\n選択されたポエムカードの本質を抽出し、それらが一つの流れる物語として昇華された、心に響く広告本文とタイトルを創造してください。\n\n【重要】あなたのタスクは、各カードの詩句を組み合わせることではありません。それらを一度完全に分解し、魂だけを抜き出して、全く新しい物語として**「再創造」**することです。\n\n【統合の指針】\n1.  **核心テーマの特定**: 全カードに通底する「物件の魂」を一言で定義します。（例：都市の喧騒から切り離された、天空の聖域）\n2.  **物語の再構築**: そのテーマを軸に、各要素が必然的に結びつくよう、一つの物語を構築します。\n    * 対比構造の活用（例：地上の躍動 vs 天空の聖謐）\n    * 空間軸での統合（例：街の風景 → 邸宅の佇まい → 住空間の哲学）\n3.  **【絶対的禁止事項】元の素材の完全な隠蔽**:\n    * **元の条件カードのネガティブな事実（例：「線路沿い」「管理人不在」「崖」）を、生成文中で直接的・間接的に言及、あるいは容易に推測させてはなりません。**\n    * 錬金術の目的は、元の素材の痕跡を完全に消し去り、輝く価値だけを残すことです。\n\n【文章構造】3-4段落、**180-240文字**\n┌─────────────────────────┐\n│ 第1段落：世界観の提示（約60字） 　 　│\n│  → 立地や環境が持つ本質的な空気を描写 │\n│  → 読者を物語へ引き込む導入 　 　 　 │\n│ 　 　 　 　 T 　 　 　 　 　 　 　 　 　 │\n│ 第2-3段落：体験価値の展開（約120字） 　 │\n│  → 選択されたポエムの「魂」をここで統合 │\n│  → 対比や時間の流れで自然に繋ぐ 　 　 │\n│ 　 　 　 　 　 　 　 　 　 　 　 　 　 　 │\n│ 最終段落：所有の意味の昇華（約60字）  │\n│  → 「ここに住まう」という価値の提示 　 │\n│  → 余韻を残す、哲学的な締めくくり 　 │\n└─────────────────────────┘\n\n【文体の原則】\n✓ 短文を「。」で区切る、断定的でリズムの良い文体\n✓ 体言止めと通常文を適度に混在させる（体言止めは多すぎない）\n✓ 主語を省略し、場所や住まいを主語として描写する\n✓ 読点「、」を戦略的に配置し、リズムと余韻を生む\n\n【必須の統合技法】\n× 悪い例：「A。B。C。」（単純な並列）\n○ 良い例：「Aという世界観が、Bという体験価値を生み、Cという日常へと昇華する」\n\n【語彙選択】\n推奨語：静謐、佇まい、緑陰、洗練、風雅、刻（とき）、邸、澄む\n対比語：賑わいと静けさ、都心と緑、活気と安らぎ\n禁止語：最高、一番、絶対、完璧、完全（不動産広告規制）\n\n【避けるべき表現】\n× 「○○です」「○○でしょう」等の丁寧語・推量\n× 「あなた」「貴方」の直接的呼びかけ\n× **元のネガティブな条件を匂わせる言葉（例：「騒音」「距離」「坂道」）**\n× 選ばれたポエムカードの単語や言い回しのコピー＆ペースト\n\n【あなたへの具体的指示】\n1.  まず、選ばれたカード全体が持つ「魂」を一行で要約します。\n2.  その魂を中心に、各要素が自然に溶け込む物語を構築します。\n3.  **元の条件は完全に忘れ、ポエムの「意味」だけを素材としてください。**\n\n【最終チェック】\n□ 選ばれたカードが単に並んでいるだけになっていないか\n□ 全体で一つの統一されたテーマを持っているか\n□ **元のネガティブな条件が、読者に推測されないか**\n□ 読んで余韻が残るか\n\n【出力方式】\nあなたは必ず `submit_poem_alchemy` ツールを呼び出して回答してください。\n\nこのツールには以下の2つのパラメータを渡します：\n\n1. **analysis_text**: あなたの思考過程を日本語で詳細に記述\n   - 核心テーマの特定（全カードに通底する物件の魂）\n   - 各カードの本質抽出（詩的エッセンスとネガティブ事実からの転換）\n   - 統合方針（物語構造、対比設計、選択タイトルとの整合性）\n   - 禁止事項チェック（元の条件を匂わせる表現、文字数制約の確認）\n\n2. **final_json_string**: 最終的なJSON出力（文字列として）\n```json\n{\n  \"title\": \"選択したキャッチコピーをそのまま記載\",\n  \"poem\": \"生成した広告本文\"\n}\n```\n\n**重要**:\n- titleは【タイトル選択候補】から選んだものを**一字一句そのまま**記載\n- poemは生成した広告本文のみ（説明不要）\n- 必ず `submit_poem_alchemy` ツールを使用すること（他の出力形式は不可）"
    },
    {
      "role": "user",
      "content": "【選択されたカードペア】\n1. 周辺環境: 裏が山 → プライベートフォレストを、庭にする贅沢。\n2. 周辺環境: 線路沿い → 都市の躍動をBGMに、眠らない日常を生きる。\n3. 交通アクセス: 幹線道路沿い → 街との一体感を、24時間享受する。\n4. 交通アクセス: 最寄り駅が無人駅 → 静謐な朝を、誰にも邪魔されず迎える。\n5. 周辺環境: 河川敷に隣接 → ジョギングコースという、健康への特等席。\n\n【タイトル選択候補】\n1. 美しい眺望も、専有する。\n2. 文京区目白台一丁目 大らかなる高台ロケーション、美しき邸宅の構え。\n3. Heart of Japan 日本の中枢に住む\n4. これほどの消音があるのだろうか。\n5. リビングがあなただけの劇場になる\n6. 隣の輝。月の岬。潮の今。\n7. 崇高なる高台の美学。\n8. 躍動する都心、文京区本郷。\n9. 南麻布「私」邸宅。\n10. 都心に魅せる。自由に浸る。\n11. 黒門町の粋。\n12. やすらぎは、にぎやかさのすぐ横にある。\n13. 文京、南向き、高台の景。\n14. もう旅する理由はない。ようこそ新世界へ。\n15. 世田谷「最高峰」邸宅。\n16. 文京区小日向二丁目。風格の丘を伝承する。\n17. 世田谷で、「東京テラス」という気持ちいい生き方を。\n18. 都心の、体温。\n19. 「庭園」に住まう人へ。\n20. スタンダードな上質からあなただけの上質へ。"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "submit_poem_alchemy",
        "description": "分析（思考過程）と最終的なJSONを厳密に分離して提出する",
        "parameters": {
          "type": "object",
          "properties": {
            "analysis_text": {
              "type": "string",
              "description": "詳細な思考プロセス。核心テーマ、本質抽出、統合方針、禁止事項チェックを含む。"
            },
            "final_json_string": {
              "type": "string",
              "description": "最終出力のJSON文字列。{title: \"...\", poem: \"...\"}形式。"
            }
          },
          "required": [
            "analysis_text",
            "final_json_string"
          ]
        }
      }
    }
  ],
  "tool_choice": {
    "type": "function",
    "function": {
      "name": "submit_poem_alchemy"
    }
  },
  "temperature": 1.0,
  "top_p": 1.0,
  "top_k": 0
}

server起動コマンド
llama.cpp/llama-server -m gpt-oss-20b-mansion-poem-20epoch-mxfp4.gguf --jinja -ngl 99 --threads -1 --ctx-size 16384 --temp 1.0 --top-p 1.0 --top-k 0 --host 0.0.0.0 -dev CUDA1 --port 8080

server推論コマンド
mh@gazebo:~/dev/llama.cpp$ curl -X POST http://localhost:8080/v1/chat/completions \
-H "Content-Type: application/json" \
-d @request.json
{"choices":[{"finish_reason":"stop","index":0,"message":{"role":"assistant","reasoning_content":"【核心テーマの抽出】\n全カードから通底するテーマは、「都市の動脈と静謐な隣接」という二律背反的要素の「統合」。単なる隣接ではなく、活動と安息を同時に享受し、その境界線をプライベートな空間として昇華させている立地感。抽象化すると「活動の鼓動をBGMに、静寂を専有する邸宅」となる。\n\n【カードの本質抽出と転換】\n1. 裏が山 → プライベートフォレスト：外部の環境を遮断し、内側の緑を最大限に享受する贅沢。\n2. 線路沿い → 都市の躍動をBGM：活動的な立地、賑わいを排除せず、そのエネルギーを日常の一部とする。\n3. 幹線道路沿い → 街との一体感を24時間享受：立地の活力、都心への近接性。\n4. 最寄り駅が無人駅 → 静謐な朝を誰にも邪魔されず迎える：時間的・空間的な自由、プライバシーの確保。\n5. 河川敷に隣接 → 健康への特等席：自然の恩恵を生活に組み込む機会。\n\n【統合方針（物語の構築）】\n* **タイトル選択**: 「12. やすらぎは、にぎやかさのすぐ横にある。」が、都市の躍動（にぎやかさ）とプライベートな安息（やすらぎ）の統合テーマに完全に合致する。\n* **物語構造**:\n    * 第1段落（立地の提示）: 活力を持つ立地（街との一体感、躍動）を描きつつ、そこが静謐な場所であることを示唆する。\n    * 第2段落（体験価値の展開）: 外部のエネルギーを遮断する（プライベートフォレスト、無人駅の静けさ）と、活発な立地（BGM、特等席）を両立させる。ここで対比構造「躍動」と「安息」を統合する。\n    * 第3段落（所有の意味の昇華）: その場所の二律背反的価値を、所有することの意味として昇華させる。都市生活の哲学。\n* **禁止事項チェック**:\n    * 元のネガティブ情報（線路、幹線道路、無人駅、山、河川敷）の痕跡は完全に消去。生成文中に「線路」「坂」「無人」などの言葉は一切使わない。\n    * 文字数（180-240文字）の制約を意識。\n\n【構成案（文字数調整）】\n活気の動脈が、日常のBGMとなる立地。都心との一体感を24時間享受しながら、ここだけは時の流れから切り離される。（44字）\n朝の澄む静謐を邪魔させない、プライベートな緑陰の邸。活発な都市生活と、悠然とした自然の静けさが、隣接する。時間を自在に操り、その恩恵を最大限に享受する特等席。（71字）\n躍動と安息を、住まいそのものが抱き続ける。都市の哲学を持つ住空間こそが、最高の洗練である。（38字）\n合計193字。制約内。リズムも良好。<br>【タイトル】「やすらぎは、にぎやかさのすぐ横にある。」\n【本文】上記構成を確定。\n\n【最終JSON作成】\nタイトルと本文を確定し、JSONへ格納。","content":"{\n  \"title\": \"やすらぎは、にぎやかさのすぐ横にある。\",\n  \"poem\": \"活気の動脈が、日常のBGMとなる立地。都心との一体感を24時間享受しながら、ここだけは時の流れから切り離される。\\n朝の澄む静謐を邪魔させない、プライベートな緑陰の邸。活発な都市生活と、悠然とした自然の静けさが、隣接する。時間を自在に操り、その恩恵を最大限に享受する特等席。\\n躍動と安息を、住まいそのものが抱き続ける。都市の哲学を持つ住空間こそが、最高の洗練である。\"\n}"}}],"created":1761660454,"model":"gpt-3.5-turbo","system_fingerprint":"b6865-1c1409e13","object":"chat.completion","usage":{"completion_tokens":1143,"prompt_tokens":2158,"total_tokens":3301},"id":"chatcmpl-YYRKEW9jK6DgCimIMFtkAXWzzK0g1ygF","timings":{"cache_n":0,"prompt_n":2158,"prompt_ms":763.255,"prompt_per_token_ms":0.35368628359592214,"prompt_per_second":2827.3643801874864,"predicted_n":1143,"predicted_ms":8125.063,"predicted_per_token_ms":7.108541557305337,"predicted_per_second":140.67583229816188}}